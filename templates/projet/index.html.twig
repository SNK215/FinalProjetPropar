<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Document</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<script>
			function degres2radians(centreX, centreY, rayon, degres) {
var radians = (degres - 90) * Math.PI / 180.0;
return {
x: centreX + (rayon * Math.cos(radians)),
y: centreY + (rayon * Math.sin(radians))
};
}

function monArc(x, y, rayon, angleDepart, angleFin) {
var depart = degres2radians(x, y, rayon, angleFin);
var fin = degres2radians(x, y, rayon, angleDepart);
var arc180 = angleFin - angleDepart <= 180 ? "0" : "1";
var d = [
"M",
depart.x,
depart.y,
"A",
rayon,
rayon,
0,
arc180,
0,
fin.x,
fin.y,
"L",
x,
y,
"L",
depart.x,
depart.y
].join(" ");

return d;
}

function addElements(i) {
var svg = document.getElementsByTagName('svg')[0]; // Get le svg
angleDepart = angleDepart;
angleFin = (angleDepart + tabDonnees[i]);

// dessin des arcs de cercle
var path = document.createElementNS("http://www.w3.org/2000/svg", 'path'); // Create a path in SVG's namespace
path.setAttribute('fill', tabCouleur[i]);
path.setAttribute('d', monArc(120, 120, rayon, angleDepart * 3.6, angleFin * 3.6));
path.setAttribute('id', 'arc' + i);
path.setAttribute('p', i);
path.setAttribute('class', "arc");


// dessin des carres de legende
var rect = document.createElementNS("http://www.w3.org/2000/svg", 'rect'); // Create a path in SVG's namespace
rect.setAttribute('width', '16');
rect.setAttribute('height', '16');
rect.setAttribute('x', 260);
rect.setAttribute('y', 30 * i + 70);
rect.setAttribute('fill', tabCouleur[i]);
rect.setAttribute('id', 'rect' + i);

// dessin des textes de legende
var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
text.setAttribute('x', 280);
text.setAttribute('y', 30 * i + 70 + 12);
text.setAttribute('fill', '#999');
text.setAttribute('font-size', '12');
text.setAttribute('font-family', 'sans-serif');
text.setAttribute('font-weight', 'normal');
text.setAttribute('id', 'text' + i);
text.textContent = tabLabel[i]+' ('+tabDonnees[i]+'%)';

// ajout des elements au svg
svg.appendChild(path);
svg.appendChild(rect);
svg.appendChild(text);
var el = document.getElementById('arc' + i);
el.addEventListener("click", clickArc, false);
}
let total = {{ Chiffre.pourcentGrosse }} + {{ Chiffre.pourcentMoyenne }} + {{ Chiffre.pourcentPetite }};
let restant = 100 - total;
function drawGraphCam() {
angleDepart = 0;
angleFin = 0;
rayon = 100;
tabLabel = ["Grosse", "Moyenne", "Petite"];

tabDonnees = [
{{ Chiffre.pourcentGrosse }},
{{ Chiffre.pourcentMoyenne }},
{{ Chiffre.pourcentPetite }}
];
tabCouleur = ["red", "orange", "rgb(0, 195, 255)"];
cible = 'a';
// creation du SVG
document.getElementById(cible).innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width=500 height=300></svg>';
// pour chaque entree des tableaux on dessine les arc , carres et textes
for (i = 0; i < tabDonnees.length; i ++) {
addElements(i);
angleDepart = angleFin;
}
}
var clickArc = function () {
alert(tabLabel[this.getAttribute("p")] + " : " + tabDonnees[this.getAttribute("p")] + "%");
}
		</script>
	</head>
	<body onload="drawGraphCam()">
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
			<div class="container-fluid">
				<a class="navbar-brand" href="/">Projet Propar</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
					<div class="navbar-nav ">

						{% if app.user %}
							<a class="nav-link" href="/operation">Mes opérations</a>
						{% endif %}


						{% if app.user %}
							{% if app.user.NbOperationAutoriser > app.user.NbOperationEnCour %}
								<a class="nav-link" href="/operation/create">Ajout opération</a>
							{% endif %}
							{% if app.user.NbOperationAutoriser <= app.user.NbOperationEnCour %}
								<a class="nav-link disabled" href="/operation/create">Ajout opération</a>
							{% endif %}
						{% endif %}


						{% if is_granted("ROLE_SUPER_ADMIN") %}
							<li class="nav-item dropdown">
								<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
									Gestion d'utilisateurs
								</a>
								<ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
									<li>
										<a class="dropdown-item" href="/superadmin/show">Voir les utilisateurs</a>
									</li>
									<li>
										<a class="dropdown-item" href="/superadmin/registration">Nouvel utilisateur</a>
									</li>
								</ul>
							</li>

						{% endif %}
						{% if not app.user %}
							<a class="nav-link position-absolute" href="/login" style="border : solid 1px ;border-radius:5px ;right: 10px; top: 5px;">Connexion</a>
						{% else %}
							<a class="nav-link position-absolute" href="/logout" style="border : solid 1px ;border-radius:5px;right: 10px; top: 5px">Déconnexion</a>
						{% endif %}
					</div>
				</div>
			</div>
		</nav>
		{% if is_granted("ROLE_SUPER_ADMIN") %}
			<hr class="mt-5 mb-5">
			<h2 style="text-align:center;">Chiffre d'affaire</h2>
			<hr class="mt-5 mb-5">
			<div class="container px-3 py-3" id="featured-3">

				<div style="display:flex;">
					<div id='a'></div>
					<div style="display:flex; flex-direction: column; justify-content: center; padding-right: 15px; ">
						<h1>{{ Chiffre.valeur }}€</h1>
					</div>

					<div style="display:flex; flex-direction: column; justify-content: center; border-left: 2px solid rgb(190, 190, 190); padding-left: 15px;">
						<h1>Par type:
						</h1>
						<h5>&nbsp;&nbsp;&nbsp;Grosse:&nbsp;
							{{ Chiffre.Grosse }}€</h5>
						<h5>&nbsp;&nbsp;&nbsp;Moyenne:&nbsp;{{ Chiffre.Moyenne }}€</h5>
						<h5>&nbsp;&nbsp;&nbsp;Petite:&nbsp;{{ Chiffre.Petite }}€</h5>
					</div>
				{% endif %}

				<br>

			</div>

		</div>
		<hr class="mt-5 mb-5">
		<h2 style="text-align:center;">Liste des opérations en cours</h2>
		<hr class="mt-5 mb-5">

		<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/jqc-1.12.4/dt-1.11.5/datatables.min.css"/>

		<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/jqc-1.12.4/dt-1.11.5/datatables.min.js"></script>

		<div class="container px-3 py-3" id="featured-3">
			<table id="datatable" class="table table-striped table-bordered table-hover" style="width:100%">
				<thead>
					<tr>
						<th class="th-sm">Opération
						</th>
						<th class="th-sm">Description
						</th>
						<th class="th-sm">Client
						</th>
						<th class="th-sm">Employé
						</th>
						<th class="th-sm">Role
						</th>
						<th class="th-sm">Terminée ?
						</th>
						<th class="th-sm">Détail
						</th>
					</tr>
				</thead>
				<tbody>

					<tr>
						{% for operation in operations %}
							<td class={% if operation.type == "Grosse" %} "table-danger" {% endif %} {% if operation.type == "Moyenne" %} "table-warning" {% endif %} {% if operation.type == "Petite" %} "table-primary" {% endif %}>{{ operation.type }}</td>


							<td>{{ operation.description }}</td>
							<td>{{ operation.nom }}
								{{ operation.prenom }}</td>
							<td>{{ operation.getUser().nom }}
								{{ operation.getUser().prenom }}</td>
							<td>
								{% if 'ROLE_SUPER_ADMIN' in operation.getUser().getroles(TRUE)  %}
									<p>Expert</p>
								{% endif %}

								{% if 'ROLE_ADMIN' in operation.getUser().getroles(TRUE)  %}
									<p>Senior</p>
								{% endif %}

								{% if 'ROLE_USER' in operation.getUser().getroles(TRUE)  %}
									<p>Apprenti</p>
								{% endif %}
							</td>

							{% if operation.archiver  %}
								<td>Non</td>
							{% else %}
								<td class="table-dark">Oui</td>
							{% endif %}


							<td>


								{# INSERER BOUTON DETAIL ICI #}


							</td>
						</tr>

					{% endfor %}

				</tbody>
				<tfoot>
					<tr>
						<th class="th-sm">Opération
						</th>
						<th class="th-sm">Description
						</th>
						<th class="th-sm">Client
						</th>
						<th class="th-sm">Employé
						</th>
						<th class="th-sm">Role
						</th>
						<th class="th-sm">Terminée ?
						</th>
						<th class="th-sm">Détail
						</th>
					</tr>
				</tfoot>

			</tbody>
		</body>
	</body>
</html></table></div><script type="text/javascript">$(document).ready(function () {
$('#datatable').DataTable();
});</script></body></html>
